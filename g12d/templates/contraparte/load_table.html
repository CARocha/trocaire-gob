{% load tools %}
<div id="result_table">
	<table class="result_table">
		<thead>			
			<tr>
				<th rowspan="2">{{main_field|unslugify}}</th>
				<th colspan="{{opts2|length}}">{{var2.1|unslugify}}</th>
				{% if total %}
				<th rowspan="2">Total</th>
				{% endif %}				
			</tr>
			<tr>				
				{% for value in opts2 %}
				{% if tipo == 'choice' %}
				<th>{{value.1}}</th>
				{% else %}
				<th>{{value|title}}</th>
				{% endif %}
				{% endfor %}
			</tr>
		</thead>
		<tbody>
			{% for key, value in dicc.items %}
			<tr>
				<td><span>{{key}}</span></td>
				{% for k in opts2 %}
					{% if tipo == 'choice' %}
					<td><span class="activa" onclick="loadCell('{{key}}', '{{k.1}}');">{{value|get_value:k.1|length}}</span></td>
					{% else %}
					<td><span>{{value|get_value:k}}</span></td>
					{% endif %}
				{% endfor %}
				{% if total %}
					{% if tipo == 'choice' %}
					<td><span>{{value|total_dict_query}}</span></td>
					{% else %}
					<td><span>{{value|total_dict}}</span></td>
					{% endif %}
				{% endif %}
			</tr>			
			{% endfor %}
			{% if total %}
			<tr>
				<td><span><b>Total</b></span></td>
				{% for k in opts2 %}  
                <td><span>{% if tipo == 'choice' %}{{dicc|total_per_query_key:k.1}}{% else %}{{dicc|total_per_key:k}}{% endif %}</span></td>
                {% endfor %}
                <td><span>
                {% if tipo == 'choice' %}
                {{dicc|total_general:1}}
                {% else %}
                {{dicc|total_general}}
                {% endif %}
                </span>
                </td>
			</tr>
			{% endif %}
		</tbody>
	</table>
</div>

<script type="text/javascript">
	
function loadCell(key, key2){
	$.getJSON('?k='+key+'&k2='+key2, function(data){
		if(data){$('#detalle').html('');}
		_.each(data, function(obj){			
			var actividad = "<div class='actividad'><div class='data'>\
			<span>"+obj.nombre_actividad+"</span><span class='lugar'><b>"+obj.comunidad__nombre+", "+obj.municipio__nombre+"</b></span>\
			<span class='fecha'><b>"+obj.fecha+"</b></span></div><div class='media'>"
			if(obj.foto1_128x96){actividad+="<img src='"+obj.foto1_128x96+"' alt='"+obj.nombre_actividad+"'>";}
			actividad+="</div><div class='clean'></div>";
			console.log(actividad);
			$(actividad).appendTo($('#detalle'));
		});
	});
}
</script>